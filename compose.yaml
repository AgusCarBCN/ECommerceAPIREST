services:

 postgres:
    image: 'postgres:16.3'
    container_name: db_tech_products
    restart: always
    volumes:
      - ./sql/create-schema.sql:/docker-entrypoint-initdb.d/create-schema.sql
      - ./sql/data.sql:/docker-entrypoint-initdb.d/data.sql
    environment:
      - 'POSTGRES_DB=${POSTGRES_DB}'
      - 'POSTGRES_PASSWORD=${POSTGRES_PASSWORD}'
      - 'POSTGRES_USER=${POSTGRES_USER}'
    ports:
      - "5432:5432"
    networks:
      - ecommerce-network
    healthcheck:
        test: [ "CMD-SHELL", "pg_isready -U ${POSTGRES_USER}" ]
        interval: 5s
        retries: 5
        timeout: 5s
 ecommerce-api:
        build: .
        container_name: ecommerce-api
        restart: always
        ports:
          - "8081:8081"
        env_file:
          - .env
        depends_on:
          postgres:
            condition: service_healthy
        networks:
          - ecommerce-network
networks:
  ecommerce-network:
    driver: bridge


